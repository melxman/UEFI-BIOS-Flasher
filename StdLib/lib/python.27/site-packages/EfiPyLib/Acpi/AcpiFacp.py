#
# AcpiFacp.py
#
# Copyright (C) 2018 efipy.core@gmail.com All rights reserved.
#
# AcpiFacp.py is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, version 2 of the License.
#
# AcpiFacp.py is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with EfiPy.  If not, see <http://www.gnu.org/licenses/>.
#

from EfiPyAcpiBase import AcpiTables
from EfiPy.MdePkg.IndustryStandard.Acpi10 import EFI_ACPI_DESCRIPTION_HEADER

FacpSize    = 0
FacpAddress = 0

for _signature, _address, _size in AcpiTables:
  if _signature == 'FACP':
    FacpAddress = _address
    DescHeader = EFI_ACPI_DESCRIPTION_HEADER.from_address (FacpAddress)
    FacpSize    = _size
    break;

if FacpAddress == 0:
  raise ImportError ('FACP Not found')

if    DescHeader.Revision == 0x01:   # ACPI10

  from EfiPy.MdePkg.IndustryStandard.Acpi10 import EFI_ACPI_1_0_FIXED_ACPI_DESCRIPTION_TABLE as FacpHeader

elif  DescHeader.Revision == 0x03:   # ACPI20, ACPI30

  from EfiPy.MdePkg.IndustryStandard.Acpi20 import EFI_ACPI_2_0_FIXED_ACPI_DESCRIPTION_TABLE as FacpHeader

elif  DescHeader.Revision == 0x04:   # ACPI40

  from EfiPy.MdePkg.IndustryStandard.Acpi40 import EFI_ACPI_4_0_FIXED_ACPI_DESCRIPTION_TABLE as FacpHeader

elif  DescHeader.Revision == 0x05:   # ACPI50, ACPI51

  from EfiPy.MdePkg.IndustryStandard.Acpi51 import EFI_ACPI_5_1_FIXED_ACPI_DESCRIPTION_TABLE as FacpHeader
  _Table     = FacpHeader.from_address (FacpAddress)

  if _Table.MinorVersion == 0x00:
    from EfiPy.MdePkg.IndustryStandard.Acpi50 import EFI_ACPI_5_0_FIXED_ACPI_DESCRIPTION_TABLE as FacpHeader

elif  DescHeader.Revision == 0x06:   # ACPI60, ACPI61

  from EfiPy.MdePkg.IndustryStandard.Acpi60 import EFI_ACPI_6_0_FIXED_ACPI_DESCRIPTION_TABLE as FacpHeader
  _Table     = FacpHeader.from_address (FacpAddress)

  if _Table.MinorVersion == 0x01:
    from EfiPy.MdePkg.IndustryStandard.Acpi61 import EFI_ACPI_6_1_FIXED_ACPI_DESCRIPTION_TABLE as FacpHeader

if FacpAddress == 0:
  raise ImportError ('FACP Not found')

Address   = FacpAddress
Table     = FacpHeader.from_address (FacpAddress)
Size      = FacpSize
Revision  = DescHeader.Revision
