# RegisterCpuFeaturesLib.py
#
# Copyright (C) 2017 efipy.core@gmail.com All rights reserved.
#
# RegisterCpuFeaturesLib.py is free software: you can redistribute it and/or
# modify it under the terms of the GNU General Public License as published by
# the Free Software Foundation, version 2 of the License.
#
# EfiPy is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with EfiPy.  If not, see <http://www.gnu.org/licenses/>.
#

from EfiPy import *

from EfiPy.UefiCpuPkg.Register.Cpuid import CPUID_VERSION_INFO_ECX, CPUID_VERSION_INFO_EDX
from EfiPy.MdePkg.Protocol.MpService import EFI_PROCESSOR_INFORMATION

CPU_FEATURE_AESNI                           = 0
CPU_FEATURE_TURBO_MODE                      = 1
CPU_FEATURE_MWAIT                           = 2
CPU_FEATURE_ACPI                            = 3
CPU_FEATURE_EIST                            = 4
CPU_FEATURE_XD                              = 5
CPU_FEATURE_FASTSTRINGS                     = 6
CPU_FEATURE_VMX                             = 7
CPU_FEATURE_SMX                             = 8
CPU_FEATURE_SENTER                          = 9
CPU_FEATURE_LOCK_FEATURE_CONTROL_REGISTER   = 10
CPU_FEATURE_LIMIT_CPUID_MAX_VAL             = 11
CPU_FEATURE_MCE                             = 12
CPU_FEATURE_MCA                             = 13
CPU_FEATURE_MCG_CTL                         = 14
CPU_FEATURE_PENDING_BREAK                   = 15
CPU_FEATURE_C1E                             = 16
CPU_FEATURE_C1_AUTO_DEMOTION                = 17
CPU_FEATURE_C3_AUTO_DEMOTION                = 18
CPU_FEATURE_C1_UNDEMOTION                   = 19
CPU_FEATURE_C3_UNDEMOTION                   = 20
CPU_FEATURE_C_STATE                         = 21
CPU_FEATURE_TM                              = 22
CPU_FEATURE_TM2                             = 23
CPU_FEATURE_X2APIC                          = 24
CPU_FEATURE_RESERVED_25                     = 25
CPU_FEATURE_RESERVED_26                     = 26
CPU_FEATURE_RESERVED_27                     = 27
CPU_FEATURE_RESERVED_28                     = 28
CPU_FEATURE_RESERVED_29                     = 29
CPU_FEATURE_RESERVED_30                     = 30
CPU_FEATURE_RESERVED_31                     = 31

CPU_FEATURE_L2_PREFETCHER                   = (32+0)
CPU_FEATURE_L1_DATA_PREFETCHER              = (32+1)
CPU_FEATURE_HARDWARE_PREFETCHER             = (32+2)
CPU_FEATURE_ADJACENT_CACHE_LINE_PREFETCH    = (32+3)
CPU_FEATURE_DCU_PREFETCHER                  = (32+4)
CPU_FEATURE_IP_PREFETCHER                   = (32+5)
CPU_FEATURE_MLC_STREAMER_PREFETCHER         = (32+6)
CPU_FEATURE_MLC_SPATIAL_PREFETCHER          = (32+7)
CPU_FEATURE_THREE_STRICK_COUNTER            = (32+8)
CPU_FEATURE_APIC_TPR_UPDATE_MESSAGE         = (32+9)
CPU_FEATURE_ENERGY_PERFORMANCE_BIAS         = (32+10)

CPU_FEATURE_BEFORE_ALL                      = BIT27
CPU_FEATURE_AFTER_ALL                       = BIT28
CPU_FEATURE_BEFORE                          = BIT29
CPU_FEATURE_AFTER                           = BIT30
CPU_FEATURE_END                             = MAX_UINT32

class REGISTER_CPU_FEATURE_INFORMATION (Structure):
  _fields_ = [
    ("ProcessorInfo",       EFI_PROCESSOR_INFORMATION),
    ("DisplayFamily",       UINT32),
    ("DisplayModel",        UINT32),
    ("SteppingId",          UINT32),
    ("ProcessorType",       UINT32),
    ("CpuIdVersionInfoEcx", CPUID_VERSION_INFO_ECX),
    ("CpuIdVersionInfoEdx", CPUID_VERSION_INFO_EDX),
    ]
