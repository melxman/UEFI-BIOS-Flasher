# Microcode.py
#
# Copyright (C) 2017 efipy.core@gmailcom All rights reserved.
#
# Microcode.py is free software: you can redistribute it and/or
# modify it under the terms of the GNU General Public License as published by
# the Free Software Foundation, version 2 of the License.
#
# EfiPy is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with EfiPy.  If not, see <http://www.gnu.org/licenses/>.
#

from EfiPy                      import *

class CPU_MICROCODE_DATE_Bits (Structure):
  _fields_ = [
    ("Year",  UINT32, 16),
    ("Day",   UINT32, 8),
    ("Month", UINT32, 8),
  ]

class CPU_MICROCODE_DATE (Union):
  _fields_ = [
    ("Bits",      CPU_MICROCODE_DATE_Bits),
    ("Uint32",    UINT32)
  ]

class CPU_MICROCODE_PROCESSOR_SIGNATURE_Bits (Structure):
  _fields_ = [
  ("Stepping",        UINT32, 4),
  ("Model",           UINT32, 4),
  ("Family",          UINT32, 4),
  ("Type",            UINT32, 2),
  ("Reserved1",       UINT32, 2),
  ("ExtendedModel",   UINT32, 4),
  ("ExtendedFamily",  UINT32, 8),
  ("Reserved2",       UINT32, 4),
  ]

class CPU_MICROCODE_PROCESSOR_SIGNATURE (Union):
  _fields_ = [
    ("Bits",      CPU_MICROCODE_PROCESSOR_SIGNATURE_Bits),
    ("Uint32",    UINT32)
  ]

class CPU_MICROCODE_HEADER (Structure):
  _pack_   = 1
  _fields_ = [
  ("HeaderVersion",       UINT32),
  ("UpdateRevision",      UINT32),
  ("Date",                CPU_MICROCODE_DATE),
  ("ProcessorSignature",  CPU_MICROCODE_PROCESSOR_SIGNATURE),
  ("Checksum",            UINT32),
  ("LoaderRevision",      UINT32),
  ("ProcessorFlags",      UINT32),
  ("DataSize",            UINT32),
  ("TotalSize",           UINT32),
  ("Reserved",            UINT8 * 12),
  ]

class CPU_MICROCODE_EXTENDED_TABLE_HEADER (Structure):
  _pack_   = 1
  _fields_ = [
  ("ExtendedSignatureCount",  UINT32),
  ("ExtendedChecksum",        UINT32),
  ("Reserved",                UINT8 * 12),
  ]

class CPU_MICROCODE_EXTENDED_TABLE (Structure):
  _pack_   = 1
  _fields_ = [
  ("ProcessorSignature",  CPU_MICROCODE_PROCESSOR_SIGNATURE),
  ("ProcessorFlag",       UINT32),
  ("Checksum",            UINT32),
  ]

