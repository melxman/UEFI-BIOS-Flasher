# IgdOpRegion.py
#
# Copyright (C) 2017 efipy.core@gmail.com All rights reserved.
#
# IgdOpRegion.py is free software: you can redistribute it and/or
# modify it under the terms of the GNU General Public License as published by
# the Free Software Foundation, version 2 of the License.
#
# EfiPy is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with EfiPy.  If not, see <http://www.gnu.org/licenses/>.
#

from EfiPy  import *

IGD_OPREGION_HEADER_SIGN = "IntelGraphicsMem"
IGD_OPREGION_HEADER_MBOX1 = BIT0
IGD_OPREGION_HEADER_MBOX2 = BIT1
IGD_OPREGION_HEADER_MBOX3 = BIT2
IGD_OPREGION_HEADER_MBOX4 = BIT3
IGD_OPREGION_HEADER_MBOX5 = BIT4

class IGD_OPREGION_HEADER (Structure):
  _pack_   = 1
  _fields_ = [
    ("SIGN",  CHAR8 * 0x10),
    ("SIZE",  UINT32),
    ("OVER",  UINT32),
    ("SVER",  UINT8 * 0x20),
    ("VVER",  UINT8 * 0x10),
    ("GVER",  UINT8 * 0x10),
    ("MBOX",  UINT32),
    ("DMOD",  UINT32),
    ("PCON",  UINT32),
    ("DVER",  CHAR16 * 0x10),
    ("RM01",  UINT8 * 0x7C),
  ]

class IGD_OPREGION_MBOX1 (Structure):
  _pack_   = 1
  _fields_ = [
    ("DRDY", UINT32),
    ("CSTS", UINT32),
    ("CEVT", UINT32),
    ("RM11", UINT8  * 0x14),
    ("DIDL", UINT32 * 8),
    ("CPDL", UINT32 * 8),
    ("CADL", UINT32 * 8),
    ("NADL", UINT32 * 8),
    ("ASLP", UINT32),
    ("TIDX", UINT32),
    ("CHPD", UINT32),
    ("CLID", UINT32),
    ("CDCK", UINT32),
    ("SXSW", UINT32),
    ("EVTS", UINT32),
    ("CNOT", UINT32),
    ("NRDY", UINT32),
    ("DID2", UINT8 * 0x1C),
    ("CPD2", UINT8 * 0x1C),
    ("RM12", UINT8 * 4),
  ]

class IGD_OPREGION_MBOX2 (Structure):
  _pack_   = 1
  _fields_ = [
    ("SCIC",  UINT32),
    ("PARM",  UINT32),
    ("DSLP",  UINT32),
    ("RM21",  UINT8  * 0xF4),
  ]

class IGD_OPREGION_MBOX3 (Structure):
  _pack_   = 1
  _fields_ = [
    ("ARDY",  UINT32),
    ("ASLC",  UINT32),
    ("TCHE",  UINT32),
    ("ALSI",  UINT32),
    ("BCLP",  UINT32),
    ("PFIT",  UINT32),
    ("CBLV",  UINT32),
    ("BCLM",  UINT16 * 0x14),
    ("CPFM",  UINT32),
    ("EPFM",  UINT32),
    ("PLUT",  UINT8 * 0x4A),
    ("PFMB",  UINT32),
    ("CCDV",  UINT32),
    ("PCFT",  UINT32),
    ("SROT",  UINT32),
    ("IUER",  UINT32),
    ("FDSS",  UINT64),
    ("FDSP",  UINT32),
    ("STAT",  UINT32),
    ("RM31",  UINT8 * 0x46),
  ]

class IGD_OPREGION_MBOX4 (Structure):
  _pack_   = 1
  _fields_ = [
    ("RVBT",  UINT8 * 0x1800),
  ]

class IGD_OPREGION_MBOX5 (Structure):
  _pack_   = 1
  _fields_ = [
    ("PHED",  UINT32),
    ("BDDC",  UINT8 * 0x100),
    ("RM51",  UINT8 * 0x2FC),
  ]

class IGD_OPREGION_STRUCTURE (Structure):
  _pack_   = 1
  _fields_ = [
    ("Header",  IGD_OPREGION_HEADER),
    ("MBox1",   IGD_OPREGION_MBOX1 ),
    ("MBox2",   IGD_OPREGION_MBOX2 ),
    ("MBox3",   IGD_OPREGION_MBOX3 ),
    ("MBox4",   IGD_OPREGION_MBOX4 ),
    ("MBox5",   IGD_OPREGION_MBOX5 ),
  ]
