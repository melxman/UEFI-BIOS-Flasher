# Supplicant.py
#
# Copyright (C) 2015 - 2017 efipy.core@gmail.com All rights reserved.
#
# Supplicant.py is free software: you can redistribute it and/or
# modify it under the terms of the GNU General Public License as published by
# the Free Software Foundation, version 2 of the License.
#
# EfiPy is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with EfiPy.  If not, see <http://www.gnu.org/licenses/>.
#

from EfiPy import *

from EfiPy.MdePkg.Protocol.WiFi2 import EFI_80211_MAC_ADDRESS, EFI_80211_SUITE_SELECTOR

class EFI_SUPPLICANT_PROTOCOL (Structure):
  pass

EfiSupplicantEncrypt        = 0
EfiSupplicantDecrypt        = 1
EFI_SUPPLICANT_CRYPT_MODE   = UINTN

EfiSupplicant80211AKMSuite                        = 0
EfiSupplicant80211GroupDataCipherSuite            = 1
EfiSupplicant80211PairwiseCipherSuite             = 2
EfiSupplicant80211PskPassword                     = 3
EfiSupplicant80211TargetSSIDName                  = 4
EfiSupplicant80211StationMac                      = 5
EfiSupplicant80211TargetSSIDMac                   = 6
EfiSupplicant80211PTK                             = 7
EfiSupplicant80211GTK                             = 8
EfiSupplicantState                                = 9
EfiSupplicant80211LinkState                       = 10
EfiSupplicantKeyRefresh                           = 11
EfiSupplicant80211SupportedAKMSuites              = 12
EfiSupplicant80211SupportedSoftwareCipherSuites   = 13
EfiSupplicant80211SupportedHardwareCipherSuites   = 14
EfiSupplicant80211IGTK                            = 15
EfiSupplicantDataTypeMaximum                      = 16
EFI_SUPPLICANT_DATA_TYPE                          = UINTN

Ieee80211UnauthenticatedUnassociated  = 0
Ieee80211AuthenticatedUnassociated    = 1
Ieee80211PendingRSNAuthentication     = 2
Ieee80211AuthenticatedAssociated      = 3
EFI_80211_LINK_STATE                  = UINTN

Group                     = 0
Pairwise                  = 1
PeerKey                   = 2
IGTK                      = 3
EFI_SUPPLICANT_KEY_TYPE   = UINTN

Receive                         = 0
Transmit                        = 1
Both                            = 2
EFI_SUPPLICANT_KEY_DIRECTION    = UINTN

class EFI_SUPPLICANT_KEY_REFRESH (Structure):
  _fields_ = [
    ("GTKRefresh",  BOOLEAN),
    ]

EFI_MAX_KEY_LEN = 64

class EFI_SUPPLICANT_KEY (Structure):
  _fields_ = [
    ("Key",             UINT8 * EFI_MAX_KEY_LEN),
    ("KeyLen",          UINT8),
    ("KeyId",           UINT8),
    ("KeyType",         EFI_SUPPLICANT_KEY_TYPE),
    ("Addr",            EFI_80211_MAC_ADDRESS),
    ("Rsc",             UINT8 * 8),
    ("RscLen",          UINT8),
    ("IsAuthenticator", BOOLEAN),
    ("CipherSuite",     EFI_80211_SUITE_SELECTOR),
    ("Direction",       EFI_SUPPLICANT_KEY_DIRECTION),
    ]

class EFI_SUPPLICANT_GTK_LIST (Structure):
  _fields_ = [
    ("GTKCount",  UINT8),
    ("GTKList",   EFI_SUPPLICANT_KEY * 1),
    ]

class EFI_SUPPLICANT_FRAGMENT_DATA (Structure):
  _fields_ = [
    ("FragmentLength",  UINT32),
    ("FragmentBuffer",  PVOID),
    ]

EFI_SUPPLICANT_BUILD_RESPONSE_PACKET = CFUNCTYPE (
  EFI_STATUS,
  POINTER(EFI_SUPPLICANT_PROTOCOL), #   IN     *This,
  POINTER(UINT8),                   #   IN     *RequestBuffer,     OPTIONAL
  UINTN,                            #   IN     RequestBufferSize,  OPTIONAL
  POINTER(UINT8),                   #      OUT *Buffer,
  POINTER(UINTN)                    #   IN OUT *BufferSize
  )

EFI_SUPPLICANT_PROCESS_PACKET = CFUNCTYPE (
  EFI_STATUS,
  POINTER(EFI_SUPPLICANT_PROTOCOL),       #   IN     *This,
  POINTER(EFI_SUPPLICANT_FRAGMENT_DATA),  #   IN OUT **FragmentTable,
  POINTER(UINT32),                        #   IN     *FragmentCount,
  EFI_SUPPLICANT_CRYPT_MODE               #   IN     CryptMode
  )

EFI_SUPPLICANT_SET_DATA = CFUNCTYPE (
  EFI_STATUS,
  POINTER(EFI_SUPPLICANT_PROTOCOL),   #   IN *This,
  EFI_SUPPLICANT_DATA_TYPE,           #   IN DataType,
  PVOID,                              #   IN *Data,
  UINTN                               #   IN DataSize
  )

EFI_SUPPLICANT_GET_DATA = CFUNCTYPE (
  EFI_STATUS,
  POINTER(EFI_SUPPLICANT_PROTOCOL),   #   IN     *This,
  POINTER(EFI_SUPPLICANT_DATA_TYPE),  #   IN     DataType,
  UINT8,                              #      OUT *Data,     OPTIONAL
  POINTER(UINTN)                      #   IN OUT *DataSize
  )

EFI_SUPPLICANT_PROTOCOL._fields_ = [
  ("BuildResponsePacket", EFI_SUPPLICANT_BUILD_RESPONSE_PACKET),
  ("ProcessPacket",       EFI_SUPPLICANT_PROCESS_PACKET),
  ("SetData",             EFI_SUPPLICANT_SET_DATA),
  ("GetData",             EFI_SUPPLICANT_GET_DATA),
  ]

gEfiSupplicantServiceBindingProtocolGuid = EFI_GUID(0x45bcd98e, 0x59ad, 0x4174, (0x95, 0x46, 0x34, 0x4a, 0x7, 0x48, 0x58, 0x98))
gEfiSupplicantProtocolGuid = EFI_GUID(0x54fcc43e, 0xaa89, 0x4333, (0x9a, 0x85, 0xcd, 0xea, 0x24, 0x5, 0x1e, 0x9e))
