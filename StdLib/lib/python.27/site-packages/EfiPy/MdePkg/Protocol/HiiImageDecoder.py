# HiiImageDecoder.py
#
# Copyright (C) 2017 efipy.core@gmail.com All rights reserved.
#
# HiiImageDecoder.py is free software: you can redistribute it and/or
# modify it under the terms of the GNU General Public License as published by
# the Free Software Foundation, version 2 of the License.
#
# EfiPy is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with EfiPy.  If not, see <http://www.gnu.org/licenses/>.
#

from EfiPy  import *

from EfiPy.MdePkg.Protocol.HiiImage import EFI_IMAGE_OUTPUT

class EFI_HII_IMAGE_DECODER_PROTOCOL (Structure):
  pass

EFI_HII_IMAGE_DECODER_COLOR_TYPE_RGB     = 0x0
EFI_HII_IMAGE_DECODER_COLOR_TYPE_RGBA    = 0x1
EFI_HII_IMAGE_DECODER_COLOR_TYPE_CMYK    = 0x2
EFI_HII_IMAGE_DECODER_COLOR_TYPE_UNKNOWN = 0xFF
EFI_HII_IMAGE_DECODER_COLOR_TYPE         = UINTN

class EFI_HII_IMAGE_DECODER_IMAGE_INFO_HEADER (Structure):
  _fields_ = [
  ("DecoderName",       EFI_GUID),
  ("ImageInfoSize",     UINT16),
  ("ImageWidth",        UINT16),
  ("ImageHeight",       UINT16),
  ("ColorType",         EFI_HII_IMAGE_DECODER_COLOR_TYPE),
  ("ColorDepthInBits",  UINT8),
  ]

EFI_IMAGE_JPEG_SCANTYPE_PROGREESSIVE = 0x01
EFI_IMAGE_JPEG_SCANTYPE_INTERLACED   = 0x02

class EFI_HII_IMAGE_DECODER_JPEG_INFO (Structure):
  _fields_ = [
  ("Header",       EFI_HII_IMAGE_DECODER_IMAGE_INFO_HEADER),
  ("ScanType",     UINT16),
  ("Reserved",     UINT64),
  ]

class EFI_HII_IMAGE_DECODER_PNG_INFO (Structure):
  _fields_ = [
  ("Header",       EFI_HII_IMAGE_DECODER_IMAGE_INFO_HEADER),
  ("Channels",     UINT16),
  ("Reserved",     UINT64),
  ]

class EFI_HII_IMAGE_DECODER_OTHER_INFO (Structure):
  _fields_ = [
  ("Header",        EFI_HII_IMAGE_DECODER_IMAGE_INFO_HEADER),
  ("ImageExtenion", UINT16 * 1),
  ]

EFI_HII_IMAGE_DECODER_GET_NAME = CFUNCTYPE (
  EFI_STATUS,
  POINTER(EFI_HII_IMAGE_DECODER_PROTOCOL),  # IN       *This
  POINTER(POINTER(EFI_GUID)),               # IN  OUIT **DecoderName,
  POINTER(POINTER(UINT16))                  # IN  OUIT *NumberOfDecoderName
  )

EFI_HII_IMAGE_DECODER_GET_IMAGE_INFO = CFUNCTYPE (
  EFI_STATUS,
  POINTER(EFI_HII_IMAGE_DECODER_PROTOCOL),                  # IN       *This
  PVOID,                                                    # IN       *Image,
  UINTN,                                                    # IN       SizeOfImage
  POINTER(POINTER(EFI_HII_IMAGE_DECODER_IMAGE_INFO_HEADER)) # IN OUT   **ImageInfo
  )

EFI_HII_IMAGE_DECODER_DECODE = CFUNCTYPE (
  EFI_STATUS,
  POINTER(EFI_HII_IMAGE_DECODER_PROTOCOL),  # IN       *This
  PVOID,                                    # IN       *Image,
  UINTN,                                    # IN       ImageRawDataSize
  POINTER(POINTER(EFI_IMAGE_OUTPUT)),       # IN OUT   **Bitmap
  BOOLEAN                                   # IN       Transparent
  )

EFI_HII_IMAGE_DECODER_PROTOCOL._fields_ = [
    ("GetImageDecoderName", EFI_HII_IMAGE_DECODER_GET_NAME),
    ("GetImageInfo",        EFI_HII_IMAGE_DECODER_GET_IMAGE_INFO),
    ("DecodeImage",         EFI_HII_IMAGE_DECODER_DECODE),
  ]

gEfiHiiImageDecoderProtocolGuid      = \
  EFI_GUID (0x9e66f251, 0x727c, 0x418c, (0xbf, 0xd6, 0xc2, 0xb4, 0x25, 0x28, 0x18, 0xea))

gEfiHiiImageDecoderNameJpegGuid      = \
  EFI_GUID (0xefefd093, 0xd9b, 0x46eb,  (0xa8, 0x56, 0x48, 0x35, 0x7, 0x0, 0xc9, 0x8))

gEfiHiiImageDecoderNamePngGuid       = \
  EFI_GUID (0xaf060190, 0x5e3a, 0x4025, (0xaf, 0xbd, 0xe1, 0xf9, 0x5, 0xbf, 0xaa, 0x4c))

