# TcgStorageOpal.py
#
# Copyright (C) 2017 efipy.core@gmail.com All rights reserved.
#
# TcgStorageOpal.py is free software: you can redistribute it and/or
# modify it under the terms of the GNU General Public License as published by
# the Free Software Foundation, version 2 of the License.
#
# EfiPy is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with EfiPy.  If not, see <http://www.gnu.org/licenses/>.
#

from EfiPy.MdePkg.IndustryStandard import *

from EfiPy.MdePkg.IndustryStandard.TcgStorageCore import TCG_LEVEL0_FEATURE_DESCRIPTOR_HEADER, TCG_TPER_FEATURE_DESCRIPTOR, TCG_LOCKING_FEATURE_DESCRIPTOR, TCG_BLOCK_SID_FEATURE_DESCRIPTOR

OPAL_LOCKING_SP_LOCKINGINFO_ALIGNMENTREQUIRED_COL       = 0x7
OPAL_LOCKING_SP_LOCKINGINFO_LOGICALBLOCKSIZE_COL        = 0x8
OPAL_LOCKING_SP_LOCKINGINFO_ALIGNMENTGRANULARITY_COL    = 0x9
OPAL_LOCKING_SP_LOCKINGINFO_LOWESTALIGNEDLBA_COL        = 0xA

OPAL_MIN_MAX_COM_PACKET_SIZE            = 2048
OPAL_MIN_MAX_REPONSE_COM_PACKET_SIZE    = 2048
OPAL_MIN_MAX_PACKET_SIZE                = 2028
OPAL_MIN_MAX_IND_TOKEN_SIZE             = 1992
OPAL_MIN_MAX_PACKETS                    = 1
OPAL_MIN_MAX_SUBPACKETS                 = 1
OPAL_MIN_MAX_METHODS                    = 1
OPAL_MIN_MAX_SESSIONS                   = 1
OPAL_MIN_MAX_AUTHENTICATIONS            = 2
OPAL_MIN_MAX_TRANSACTION_LIMIT          = 1

OPAL_ADMIN_SP_PIN_COL  = 3
OPAL_LOCKING_SP_C_PIN_TRYLIMIT_COL = 5
OPAL_RANDOM_METHOD_MAX_COUNT_SIZE = 32

class OPAL_GEOMETRY_REPORTING_FEATURE (EFIPY_INDUSTRY_STRUCTURE):
  _fields_ = [
  ("Header",                  TCG_LEVEL0_FEATURE_DESCRIPTOR_HEADER),
  ("Reserved",                UINT8 * 8),
  ("LogicalBlockSizeBE",      UINT32),
  ("AlignmentGranularityBE",  UINT64),
  ("LowestAlignedLBABE",      UINT64),
  ]

class OPAL_SINGLE_USER_MODE_FEATURE (EFIPY_INDUSTRY_STRUCTURE):
  _fields_ = [
  ("Header",                        TCG_LEVEL0_FEATURE_DESCRIPTOR_HEADER),
  ("NumLockingObjectsSupportedBE",  UINT32),
  ("Any",                           UINT8 , 1),
  ("All",                           UINT8 , 1),
  ("Policy",                        UINT8 , 1),
  ("Reserved",                      UINT8 , 5),
  ("Reserved2",                     UINT8 * 7),
  ]

class OPAL_DATASTORE_TABLE_FEATURE (EFIPY_INDUSTRY_STRUCTURE):
  _fields_ = [
  ("Header",          TCG_LEVEL0_FEATURE_DESCRIPTOR_HEADER),
  ("Reserved",        UINT16),
  ("MaxNumTablesBE",  UINT16),
  ("MaxTotalSizeBE",  UINT32),
  ("SizeAlignmentBE", UINT32),
  ]

class OPAL_SSCV1_FEATURE_DESCRIPTOR (EFIPY_INDUSTRY_STRUCTURE):
  _fields_ = [
  ("Header",          TCG_LEVEL0_FEATURE_DESCRIPTOR_HEADER),
  ("BaseComdIdBE",    UINT16),
  ("NumComIdsBE",     UINT16),
  ("RangeCrossing",   UINT8, 1),
  ("Reserved",        UINT8, 7),
  ("Future",          UINT8 * 11),
  ]

class OPAL_SSCV2_FEATURE_DESCRIPTOR (EFIPY_INDUSTRY_STRUCTURE):
  _fields_ = [
  ("Header",                                    TCG_LEVEL0_FEATURE_DESCRIPTOR_HEADER),
  ("BaseComdIdBE",                              UINT16),
  ("NumComIdsBE",                               UINT16),
  ("Reserved",                                  UINT8),
  ("NumLockingSpAdminAuthoritiesSupportedBE",   UINT16),
  ("NumLockingSpUserAuthoritiesSupportedBE",    UINT16),
  ("InitialCPINSIDPIN",                         UINT8),
  ("CPINSIDPINRevertBehavior",                  UINT8),
  ("Future",                                    UINT8 * 5),
  ]

class OPAL_SSCLITE_FEATURE_DESCRIPTOR (EFIPY_INDUSTRY_STRUCTURE):
  _fields_ = [
  ("Header",                    TCG_LEVEL0_FEATURE_DESCRIPTOR_HEADER),
  ("BaseComdIdBE",              UINT16),
  ("NumComIdsBE",               UINT16),
  ("Reserved",                  UINT8 * 5),
  ("InitialCPINSIDPIN",         UINT8),
  ("CPINSIDPINRevertBehavior",  UINT8),
  ("Future",                    UINT8 * 5),
  ]

class PYRITE_SSC_FEATURE_DESCRIPTOR (EFIPY_INDUSTRY_STRUCTURE):
  _fields_ = [
  ("Header",                    TCG_LEVEL0_FEATURE_DESCRIPTOR_HEADER),
  ("BaseComdIdBE",              UINT16),
  ("NumComIdsBE",               UINT16),
  ("Reserved",                  UINT8 * 5),
  ("InitialCPINSIDPIN",         UINT8),
  ("CPINSIDPINRevertBehavior",  UINT8),
  ("Future",                    UINT8 * 5),
  ]

class PYRITE_SSC_FEATURE_DESCRIPTOR (EFIPY_INDUSTRY_UNION):
  _fields_ = [
  ("CommonHeader",  TCG_LEVEL0_FEATURE_DESCRIPTOR_HEADER),
  ("Tper",          TCG_TPER_FEATURE_DESCRIPTOR),
  ("Locking",       TCG_LOCKING_FEATURE_DESCRIPTOR),
  ("Geometry",      OPAL_GEOMETRY_REPORTING_FEATURE),
  ("SingleUser",    OPAL_SINGLE_USER_MODE_FEATURE),
  ("DataStore",     OPAL_DATASTORE_TABLE_FEATURE),
  ("OpalSscV1",     OPAL_SSCV1_FEATURE_DESCRIPTOR),
  ("OpalSscV2",     OPAL_SSCV2_FEATURE_DESCRIPTOR),
  ("OpalSscLite",   OPAL_SSCLITE_FEATURE_DESCRIPTOR),
  ("PyriteSsc",     PYRITE_SSC_FEATURE_DESCRIPTOR),
  ("BlockSid",      TCG_BLOCK_SID_FEATURE_DESCRIPTOR),
  ]

